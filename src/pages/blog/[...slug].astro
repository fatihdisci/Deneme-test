---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ShareButton from '../../components/ShareButton';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Calculate reading time (average 200 words per minute in Turkish)
const wordCount = entry.body.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

// Schema data
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": entry.data.title,
  "description": entry.data.description,
  "image": entry.data.image || "https://www.discilaw.com/logo.png",
  "author": {
    "@type": "Person",
    "name": "Av. Fatih Dişçi",
    "url": "https://www.discilaw.com"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Dişçi Hukuk Bürosu",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.discilaw.com/logo.png"
    }
  },
  "datePublished": entry.data.pubDate.toISOString(),
  "dateModified": entry.data.pubDate.toISOString(),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://www.discilaw.com/blog/${entry.slug}`
  },
  "articleSection": entry.data.category || "Genel"
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Anasayfa",
      "item": "https://www.discilaw.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://www.discilaw.com/blog"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": entry.data.title,
      "item": `https://www.discilaw.com/blog/${entry.slug}`
    }
  ]
};
---

<Layout title={`${entry.data.title} | Dişçi Hukuk Bürosu`} description={entry.data.description} image={entry.data.image}>
  <!-- Article Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  
  <!-- Breadcrumb Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  <!-- Progress Bar (Optional nice touch) -->
  <div class="fixed top-0 left-0 w-full h-1 z-50 bg-slate-800">
    <div class="h-full bg-gold-500 w-0" id="reading-progress"></div>
  </div>

  <article class="py-24 bg-slate-950 min-h-screen">
    <!-- Header -->
    <div class="container mx-auto px-4 max-w-4xl mb-12 text-center" data-aos="fade-up">
        <div class="mb-6 flex items-center justify-center gap-4 text-sm flex-wrap">
            <span class="text-gold-500 font-bold px-3 py-1 rounded-full bg-gold-500/10 border border-gold-500/20">
                {entry.data.category}
            </span>
            <span class="text-slate-500">•</span>
            <time class="text-slate-400">
                {entry.data.pubDate.toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <span class="text-slate-500">•</span>
            <span class="text-slate-400 flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                {readingTime} dk okuma
            </span>
        </div>
        
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-8 leading-tight">
            {entry.data.title}
        </h1>

        {entry.data.image && (
            <div class="rounded-2xl overflow-hidden shadow-2xl border border-white/10 mb-12">
                <img src={entry.data.image} alt={entry.data.title} class="w-full h-auto object-cover max-h-[500px]" />
            </div>
        )}
    </div>

    <!-- Content -->
    <div class="container mx-auto px-6 max-w-5xl">
        <div class="prose prose-invert prose-xl mx-auto max-w-5xl py-12 blog-content
      text-justify hyphens-auto prose-p:text-justify
      prose-p:text-slate-300 prose-p:leading-loose prose-p:mb-8 prose-p:mt-0
      prose-headings:text-gold-500 prose-headings:font-serif prose-headings:mb-6 prose-headings:mt-12
      prose-li:text-slate-300 prose-li:my-2 prose-li:ml-6
      prose-ul:list-disc prose-ul:pl-6 prose-ul:my-6 prose-ul:space-y-2
      prose-ol:list-decimal prose-ol:pl-6 prose-ol:my-6 prose-ol:space-y-2
      prose-blockquote:border-l-4 prose-blockquote:border-gold-500 prose-blockquote:bg-slate-900/50 prose-blockquote:py-4 prose-blockquote:px-6 prose-blockquote:rounded-r-lg prose-blockquote:not-italic prose-blockquote:my-8
      prose-strong:text-white prose-strong:font-bold" data-aos="fade-up" data-aos-delay="200" lang="tr">
            <Content />
        </div>
    </div>

    <style>
        .blog-content,
        .blog-content p,
        .blog-content li {
            text-align: justify !important;
            -webkit-hyphens: auto !important;
            -moz-hyphens: auto !important;
            -ms-hyphens: auto !important;
            hyphens: auto !important;
            word-spacing: -0.05em;
        }
    </style>

    <!-- Footer / Navigation -->
    <div class="container mx-auto px-4 max-w-4xl mt-16 pt-8 border-t border-white/10 flex justify-between items-center">
        <a href="/blog" class="inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors group">
            <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Blog'a Dön
        </a>
        
        <!-- Share Button -->
        <div class="flex gap-4">
            <ShareButton client:load title={entry.data.title} url={Astro.url.href} />
        </div>
    </div>
  </article>

  <script>
    // Simple Reading Progress Bar
    window.addEventListener('scroll', () => {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        const bar = document.getElementById('reading-progress');
        if (bar) bar.style.width = scrolled + "%";
    });
  </script>
</Layout>
